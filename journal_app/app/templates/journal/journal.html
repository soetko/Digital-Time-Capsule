{% extends "base.html" %}
{% block body_class %}paper-page{% endblock %}
{% import "bootstrap_wtf.html" as wtf %}

{% block content %}
<h1 class="text-center my-4 entry-title">My Journal</h1>

<div class="container">

    {% for journal_entry in journal_entries %}
        {% for item, entry in journal_entry.items() %}
            <div class="card p-4 mb-4 shadow-sm">
                <h4>{{ entry.title }}</h4>
                <small class="text-muted">Published on: {{ entry.date.strftime('%B %d, %Y at %I:%M %p') }}</small>

                {% if entry.image_name != 'blank' %}
                    {% set filePath = entry.image_path.replace('app/static/', '').replace('\\', '/') %}
                    {% set fullPath = url_for('static', filename=filePath) %}
                    {% if fullPath != '/app/static/blank' %}
                        <div class="my-3">
                            <img src="{{ fullPath }}" alt="Journal Image" class="img-fluid rounded" style="max-width: 70%;">
                        </div>
                    {% endif %}
                {% endif %}

                <div class="mt-3">
                    {% for line in entry.content.split('\n') %}
                        <p>{{ line }}</p>
                    {% endfor %}
                </div>

                {% if entry.get('tags') %}
                    <p class="mt-3">
                        Tags:
                        {% for tag in entry.tags %}
                            <span class="badge bg-secondary">{{ tag }}</span>
                        {% endfor %}
                    </p>
                {% endif %}

                <div class="d-flex justify-content-end mt-3">
                    <a href="{{ url_for('journal.edit_entry', entry_id=item) }}" class="btn btn-sm btn-outline-primary">Edit</a>
                </div>
            </div>
        {% endfor %}
    {% endfor %}
    <div class="d-flex justify-content-between align-items-center mt-4" style="float:right;margin-bottom:3%;">
        <button type="button" class="btn btn-outline-primary" id="downloadBtn" style="width:100%;background-color:goldenrod;" onclick="getPdf()">
            Save as PDF
        </button><br>
    </div>
</div>
<script>
    function getPdf() {
        window.print()
    }
</script>
{% endblock %}