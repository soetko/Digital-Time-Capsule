{% extends "base.html" %}
{% block body_class %}paper-page{% endblock %}
{% import "bootstrap_wtf.html" as wtf %}

{% block content %}
<h1 class="entry-title">Edit Journal Entry</h1>

<form method="POST" enctype="multipart/form-data">
    {{ form.hidden_tag() }}
    {{ wtf.form_field(form.title) }}
    {{ wtf.form_field(form.media_file) }}
    {{ wtf.form_field(form.content) }}
    {{ wtf.form_field(form.tags) }}

    <div class="d-flex justify-content-between align-items-center mt-4">
        <div>
            <span class="me-2 fw-semibold">Try our AI Features:</span>
            <button type="button" id="generate_tags" class="btn btn-outline-primary">Generate Tags</button>
        </div>
        <button type="submit" class="btn btn-primary">Save</button>
    </div>
</form>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const generateTagsButton = document.getElementById('generate_tags');
        const contentField = document.getElementById('content');
        const tagsField = document.getElementById('tags');

        if (generateTagsButton && contentField && tagsField) {
            generateTagsButton.addEventListener('click', function () {
                const content = contentField.value;
                fetch('/journal/generate_entry_tags', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 'content': content })
                })
                .then(response => response.json())
                .then(data => {
                    if (data && data.tags) {
                        tagsField.value = data.tags.join(', ');
                    }
                });
            });
        }
    });
</script>
{% endblock %}